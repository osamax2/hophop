# استكشاف أخطاء عدم ظهور المدن

## المشكلة
المدن لا تظهر في:
1. البحث (من / إلى) في الصفحة الرئيسية
2. إضافة مسار جديد في لوحة الإدارة

## الحلول المطبقة

### 1. تحسينات CitySelector
- ✅ إضافة console.log لتتبع تحميل المدن
- ✅ إضافة معالجة أخطاء أفضل
- ✅ إظهار رسالة تحذير عند فشل التحميل

### 2. إضافة واجهة إنشاء المسارات
- ✅ إضافة زر "إضافة مسار جديد" في لوحة الإدارة
- ✅ إضافة حوار إنشاء مسار مع CitySelector
- ✅ ربط مع API لإنشاء المسارات

### 3. تحسينات AdminDashboard
- ✅ إضافة console.log لتتبع تحميل المدن
- ✅ إضافة معالجة أخطاء أفضل
- ✅ التأكد من تحميل المدن عند فتح تبويب الجداول

## خطوات التحقق

### الخطوة 1: تأكد من وجود المدن في قاعدة البيانات

افتح قاعدة البيانات وتحقق:
```sql
SELECT COUNT(*) FROM cities;
```

يجب أن يكون هناك أكثر من 100 مدينة.

إذا لم تكن موجودة، قم بتشغيل:
```bash
cd backend
node insert_syrian_cities.js
```

### الخطوة 2: تأكد من أن الخادم يعمل

افتح المتصفح واذهب إلى:
```
http://localhost:4000/api/cities
```

يجب أن ترى قائمة بالمدن في JSON.

### الخطوة 3: تحقق من Console في المتصفح

1. افتح Developer Tools (F12)
2. اذهب إلى تبويب Console
3. ابحث عن رسائل:
   - "Loading cities from API..."
   - "Cities loaded: X cities"
   - "Loaded cities: X"

إذا رأيت أخطاء:
- `Failed to fetch` → الخادم غير يعمل
- `404 Not Found` → المسار غير صحيح
- `401 Unauthorized` → مشكلة في المصادقة (للوحة الإدارة)

### الخطوة 4: تحقق من API Base URL

في ملف `.env` أو `vite.config.ts`، تأكد من:
```env
VITE_API_BASE=http://localhost:4000
```

### الخطوة 5: اختبار API مباشرة

افتح Terminal وقم بتشغيل:
```bash
# Windows PowerShell
curl http://localhost:4000/api/cities

# أو استخدم Postman/Browser
# GET http://localhost:4000/api/cities
```

## الحلول السريعة

### إذا لم تظهر المدن في البحث:

1. **افتح Console في المتصفح** (F12)
2. **تحقق من الأخطاء**
3. **إذا رأيت "Failed to fetch":**
   - تأكد من أن الخادم يعمل: `cd backend && npm run dev`
   - تأكد من أن المنفذ 4000 متاح

4. **إذا رأيت "No cities available":**
   - تأكد من وجود المدن في قاعدة البيانات
   - قم بتشغيل `node insert_syrian_cities.js`

### إذا لم تظهر المدن في إضافة مسار:

1. **سجل دخول كـ Admin أو Agent**
2. **اذهب إلى لوحة الإدارة**
3. **افتح تبويب "إدارة الجداول"**
4. **اضغط على "إضافة مسار جديد"**
5. **تحقق من Console للأخطاء**

## الميزات الجديدة

### 1. زر إضافة مسار جديد
- يظهر في تبويب "إدارة الجداول"
- زر أزرق بجانب زر "إضافة جدول"

### 2. حوار إنشاء مسار
- يستخدم CitySelector للبحث عن المدن
- يتحقق من أن المدن مختلفة
- ينشئ المسار في قاعدة البيانات

### 3. تحسينات CitySelector
- رسائل خطأ واضحة
- console.log للمساعدة في التصحيح
- معالجة أفضل للحالات الفارغة

## اختبار سريع

1. **افتح الصفحة الرئيسية**
2. **اضغط على "من" أو "إلى"**
3. **يجب أن يفتح dropdown مع قائمة المدن**
4. **اكتب في حقل البحث** (مثل "دم")
5. **يجب أن ترى المدن المطابقة**

إذا لم يعمل:
- افتح Console (F12)
- ابحث عن الأخطاء
- شارك رسالة الخطأ

## ملاحظات

- المدن تُحمّل عند فتح المكون لأول مرة
- البحث يعمل فوراً أثناء الكتابة
- المدن مرتبة أبجدياً
- يمكن البحث بالعربية أو الإنجليزية
